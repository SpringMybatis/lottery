<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>setting</title>
    <link rel="stylesheet" href="dist/css/bootstrap.min.css"/>
    <script type="text/javascript" src="dist/js/jquery.min.js"></script>
    <script type="text/javascript" src="dist/js/bootstrap.min.js"></script>

    <script type="text/javascript">

        $(function () {

            function getCnLevel(level){
                switch (level){
                    case '0':
                        return "特等奖";
                    case '1':
                        return "一等奖";
                    case '2':
                        return "二等奖";
                    case '3':
                        return "三等奖";
                    case '4':
                        return "四等奖";
                    default:
                        return "？？？";
                }
            }

            function nowProcess() {
                $.get("process", function (data) {
                    if ($.isEmptyObject(data) || data.sort == 0) {
                        $("#nowLevel").text("抽奖结束");
                    }
                    else {
                        $("#nowLevel").text(data.sort+"当前是抽" + data.desc + "等奖,共抽" + data.num + "名");
                    }

                });
            }

            function showPerson(data) {
                $("#result").html('');
                for (var i in data) {
                    $("#result").append('<span class="btn">' + data[i] + '-' + i + '</span>');
                }
            }

            $("#init").on("click", function () {
                $.get("reset", {}, function (data) {
                    $("#result").text(data);
                    nowProcess();
                })
            });

            function lottery() {
                $.get("lottery", {}, function (data) {
                    if (!$.isEmptyObject(data)) {
                        showPerson(data);
                        nowProcess();
                    }
                })
            }

            $("#lottery").on("click", lottery);
            $("#unlottery").on("click", function () {
                $.get("unlottery", {}, function (data) {
                    nowProcess();
                    $("#level").text('');
                    $("#luckyPerson").trigger("click");
                })
            });

            $("#luckyPerson").on("click", function () {
                $.get("/lucky/" + $("#level").val(), {}, function (data) {
                    if ($("#level").val() != '') {
                        showPerson(data);
                    }
                    else {
                        var result = $("#result");
                        result.html('');
                        for (var i in data) {
                            result.append("<h4>"+getCnLevel(i)+"</h4>");
                            var persons = data[i];
                            for (var j in persons) {
                                result.append('<span class="btn">' + persons[j] + '-' + j + '</span>');
                            }
                        }
                    }

                })
            });

            $("#person").on("click", function () {
                $("#level").val('');
                $.get("person", {}, function (data) {
                    showPerson(data);
                })
            });

            $(document).keydown(function (e) {
                if (!e) var e = window.event;
                if (e.keyCode == 32) {
                    lottery();
                }
            });

            nowProcess();
        });
    </script>
</head>
<body>

<div class="panel panel-default">
    <div class="panel-heading"><h1 id="nowLevel"></h1></div>

    <div class="panel-body" th:if="${isManager}">
        <button class="btn btn-success" id="lottery">抽奖</button>
        <button id="unlottery" class="btn btn-danger">取消上次结果</button>
        <button id="init" class="btn btn-primary">初始化</button>
    </div>
</div>



<div class="panel panel-default">
    <div class="panel-heading">
        <h3>抽奖结果</h3><br/>
        <div class="input-group" >
            <div class="input-group-addon">等级</div>
            <input class="form-control" type="text" id="level"/>
            <span class="input-group-btn">
                <button class="btn btn-default" id="luckyPerson" type="button">中奖人员</button>
                <button class="btn btn-default" id="person">全部人员</button>
            </span>
        </div>
    </div>
    <div class="panel-body">
        <div id="result">
        </div>
    </div>
</div>



</body>
</html>